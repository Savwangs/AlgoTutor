<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CS61A Mentor+</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg-main: #020617;
        --bg-panel: #020617;
        --bg-editor: #020617;
        --bg-output: #020617;
        --border-subtle: #1f2933;
        --accent: #4f46e5;
        --accent-soft: rgba(79, 70, 229, 0.16);
        --accent-strong: rgba(79, 70, 229, 0.9);
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --text-strong: #f9fafb;
        --badge-bg: #111827;
        --badge-accent-bg: #1e293b;
        --error: #f97373;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro",
          "Inter", sans-serif;
      }

      html,
      body {
        width: 100%;
        min-height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: radial-gradient(circle at top left, #111827, #020617 45%);
        padding: 10px;
        color: var(--text-main);
      }

      main {
        max-width: 960px;
        margin: 0 auto;
        border-radius: 16px;
        background: radial-gradient(circle at top left, #020617, #020617 40%);
        border: 1px solid #1f2933;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.75);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      header {
        padding: 12px 16px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.3);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        background: linear-gradient(
          to right,
          rgba(15, 23, 42, 0.9),
          rgba(15, 23, 42, 0.7)
        );
      }

      .title-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      h2 {
        margin: 0;
        font-size: 0.98rem;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        color: var(--text-strong);
      }

      p.subtitle {
        margin: 0;
        font-size: 0.78rem;
        color: var(--text-muted);
      }

      .chip-row {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.7rem;
      }

      .chip {
        border-radius: 999px;
        padding: 2px 8px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        color: var(--text-muted);
      }

      .chip.accent {
        border-color: rgba(79, 70, 229, 0.8);
        color: #c7d2fe;
        background: rgba(79, 70, 229, 0.14);
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
        gap: 0;
        min-height: 320px;
      }

      /* Left pane (editor / inputs) */

      .pane-left {
        border-right: 1px solid rgba(31, 41, 55, 0.9);
        background: radial-gradient(
            circle at top left,
            rgba(37, 99, 235, 0.08),
            transparent 55%
          ),
          var(--bg-editor);
        padding: 12px 14px 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      label {
        font-size: 0.78rem;
        font-weight: 500;
        color: var(--text-muted);
      }

      .field-block {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      textarea,
      select,
      input[type="text"] {
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        padding: 7px 9px;
        font-size: 0.78rem;
        box-sizing: border-box;
        background-color: #020617;
        color: var(--text-main);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }

      textarea {
        min-height: 145px;
        resize: vertical;
      }

      textarea:focus,
      select:focus,
      input[type="text"]:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.55);
      }

      select {
        font-family: inherit;
        background-color: #020617;
      }

      .row {
        display: flex;
        gap: 8px;
      }

      .row > div {
        flex: 1;
      }

      .hint {
        font-size: 0.72rem;
        color: var(--text-muted);
        margin: 0;
      }

      .controls-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 6px;
        margin-top: 4px;
      }

      button.primary {
        border: none;
        border-radius: 999px;
        background: linear-gradient(
          to right,
          var(--accent-strong),
          #6366f1
        );
        color: #f9fafb;
        font-weight: 600;
        padding: 6px 16px;
        cursor: pointer;
        font-size: 0.78rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.4),
          0 10px 25px rgba(15, 23, 42, 0.9);
      }

      button.primary span.icon {
        font-size: 0.85rem;
      }

      button.primary:disabled {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
      }

      .secondary-btn {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: transparent;
        color: var(--text-muted);
        font-size: 0.7rem;
        padding: 4px 10px;
        cursor: pointer;
      }

      .secondary-btn:hover {
        border-color: var(--accent);
        color: #c7d2fe;
      }

      .status {
        font-size: 0.72rem;
        color: var(--text-muted);
      }

      .status[data-state="loading"]::before {
        content: "‚è≥ ";
      }

      .status[data-state="ok"]::before {
        content: "‚úÖ ";
      }

      .status[data-state="idle"]::before {
        content: "üí° ";
      }

      /* Right pane (output / tabs) */

      .pane-right {
        background: radial-gradient(
            circle at top right,
            rgba(37, 99, 235, 0.12),
            transparent 55%
          ),
          var(--bg-output);
        padding: 10px 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .tabs-row {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 2px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(31, 41, 55, 0.95);
        font-size: 0.74rem;
      }

      .tab {
        flex: 1;
        text-align: center;
        padding: 4px 0;
        border-radius: 999px;
        cursor: pointer;
        color: var(--text-muted);
        user-select: none;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .tab.active {
        background: var(--accent-soft);
        color: #e0e7ff;
        font-weight: 500;
      }

      .session-summary {
        border-radius: 8px;
        padding: 6px 8px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        background: rgba(15, 23, 42, 0.9);
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .badge-row {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }

      .badge {
        border-radius: 999px;
        padding: 1px 7px;
        font-size: 0.66rem;
        background: var(--badge-bg);
        color: var(--text-muted);
        border: 1px solid rgba(55, 65, 81, 0.9);
      }

      .badge.accent {
        background: var(--badge-accent-bg);
        color: #e0f2fe;
        border-color: rgba(59, 130, 246, 0.9);
      }

      .code-header {
        font-size: 0.7rem;
        color: var(--text-muted);
      }

      .code-snippet {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 0.78rem;
        white-space: pre-wrap;
        background: #020617;
        color: #e5e7eb;
        border-radius: 6px;
        padding: 4px 6px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        margin-top: 2px;
      }

      .output-panel {
        flex: 1;
        border-radius: 10px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        background: radial-gradient(
            circle at top center,
            rgba(15, 23, 42, 0.9),
            rgba(15, 23, 42, 1)
          ),
          #020617;
        padding: 8px 9px;
        overflow: auto;
        font-size: 0.8rem;
      }

      .output-panel h4 {
        margin: 0 0 4px;
        font-size: 0.8rem;
        color: var(--text-strong);
      }

      .output-panel p {
        margin: 0 0 4px;
      }

      .mono-box,
      pre {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 0.78rem;
        white-space: pre-wrap;
        background: #020617;
        color: #e5e7eb;
        border-radius: 6px;
        padding: 4px 6px;
        border: 1px solid rgba(31, 41, 55, 0.9);
      }

      .output-empty {
        font-size: 0.76rem;
        color: var(--text-muted);
        font-style: italic;
      }

      .error-text {
        color: var(--error);
        font-weight: 500;
      }

      .pill-label {
        font-size: 0.7rem;
        color: var(--text-muted);
        margin-bottom: 4px;
      }

      .top-row-right {
        display: flex;
        flex-direction: column;
        gap: 3px;
        align-items: flex-end;
      }
    </style>
  </head>

  <body>
    <main>
      <header>
        <div class="title-block">
          <h2>CS61A Mentor+</h2>
          <p class="subtitle">
            Mini IDE for environment diagrams, recursion traces, and exam-style
            reasoning.
          </p>
        </div>
        <div class="top-row-right">
          <div class="chip-row">
            <span class="chip accent">Python / Scheme / SQL</span>
            <span class="chip">MCP Widget</span>
            <span class="chip">Session-aware</span>
          </div>
          <span class="pill-label"
            >All detailed answers are written into this panel, not the
            chat.</span
          >
        </div>
      </header>

      <div class="layout">
        <!-- LEFT PANE: code + controls -->
        <section class="pane-left">
          <form id="mentor-form" autocomplete="off">
            <div class="field-block">
              <label for="code-input">Code or expression</label>
              <textarea
                id="code-input"
                name="code"
                placeholder="Paste your CS 61A code, Scheme expression, or SQL query here..."
              ></textarea>
              <p class="hint">
                Don‚Äôt include solution keys or copyrighted exam PDFs ‚Äî just the
                code / expression you‚Äôre working on.
              </p>
            </div>

            <div class="row">
              <div class="field-block">
                <label for="language-select">Language</label>
                <select id="language-select" name="language">
                  <option value="python">Python (61A subset)</option>
                  <option value="scheme">Scheme</option>
                  <option value="sql">SQL</option>
                  <option value="oop">OOP / Classes</option>
                  <option value="other">Other (Links, Trees, macros‚Ä¶)</option>
                </select>
              </div>
              <div class="field-block">
                <label for="task-select">Task type</label>
                <select id="task-select" name="taskType">
                  <option value="explain">
                    Explain step-by-step (beginner friendly)
                  </option>
                  <option value="env_diagram">
                    Build an environment diagram
                  </option>
                  <option value="recursion_trace">
                    Trace recursion / calls
                  </option>
                  <option value="tree_help">
                    Help with Trees / Links
                  </option>
                  <option value="fill_blanks">
                    Help fill exam-style blanks
                  </option>
                </select>
              </div>
            </div>

            <div class="field-block">
              <label for="question-input">Optional question</label>
              <input
                id="question-input"
                name="question"
                type="text"
                placeholder="e.g. Why does this return None? Where is the new frame created?"
              />
            </div>

            <div class="controls-row">
              <button type="submit" class="primary" id="submit-btn">
                <span class="icon">‚ñ∂</span>
                <span>Send to CS61A Mentor</span>
              </button>
              <button
                type="button"
                class="secondary-btn"
                id="refresh-btn"
                title="Reload last session from server"
              >
                Refresh session
              </button>
            </div>

            <div class="status" id="status-label" data-state="idle">
              Ready. Fill the form and submit to update the CS61A context.
            </div>
          </form>
        </section>

        <!-- RIGHT PANE: session info + outputs -->
        <section class="pane-right">
          <div class="session-summary" id="session-summary">
            <div class="badge-row" id="badge-row"></div>
            <div id="summary-text">
              <em>No active CS61A session yet. Submit code to create one.</em>
            </div>
            <div class="code-header" id="code-header" style="display: none">
              Code snippet
            </div>
            <div class="code-snippet" id="code-snippet" style="display: none">
              <!-- filled by JS -->
            </div>
          </div>

          <div class="tabs-row" id="tabs-row">
            <div class="tab active" data-tab="summary">Summary</div>
            <div class="tab" data-tab="explanation">Explanation</div>
            <div class="tab" data-tab="trace">Recursion trace</div>
            <div class="tab" data-tab="env">Env diagram</div>
            <div class="tab" data-tab="trees">Trees / Links</div>
            <div class="tab" data-tab="fill">Fill blanks</div>
            <div class="tab" data-tab="status">Status</div>
          </div>

          <div class="output-panel" id="output-panel">
            <!-- Filled dynamically based on active tab -->
            <p class="output-empty">
              Submit code on the left, then ask ChatGPT to explain, trace, or
              draw environment diagrams. Answers will appear here.
            </p>
          </div>
        </section>
      </div>
    </main>

    <script type="module">
      const formEl = document.querySelector("#mentor-form");
      const codeInput = document.querySelector("#code-input");
      const langSelect = document.querySelector("#language-select");
      const taskSelect = document.querySelector("#task-select");
      const questionInput = document.querySelector("#question-input");
      const statusEl = document.querySelector("#status-label");
      const submitBtn = document.querySelector("#submit-btn");
      const refreshBtn = document.querySelector("#refresh-btn");

      const badgeRowEl = document.querySelector("#badge-row");
      const summaryTextEl = document.querySelector("#summary-text");
      const codeHeaderEl = document.querySelector("#code-header");
      const codeSnippetEl = document.querySelector("#code-snippet");
      const tabsRowEl = document.querySelector("#tabs-row");
      const outputPanelEl = document.querySelector("#output-panel");

      //
      // Helper: get initial state from various possible locations
      //
      const getInitialState = () => {
        const w = window.openai || {};
        if (w.globals?.toolOutput) return w.globals.toolOutput;
        if (w.state?.toolOutput) return w.state.toolOutput;
        if (w.widgetState?.toolOutput) return w.widgetState.toolOutput;
        return {
          currentSession: null,
          recentSessions: [],
        };
      };

      let currentState = getInitialState();
      let activeTab = "summary";

      const languageLabel = (value) =>
        (
          {
            python: "Python",
            scheme: "Scheme",
            sql: "SQL",
            oop: "OOP",
            other: "Other",
          }[value] || value
        );

      const taskLabel = (value) =>
        (
          {
            explain: "Explain",
            env_diagram: "Environment diagram",
            recursion_trace: "Recursion trace",
            tree_help: "Trees / Links help",
            fill_blanks: "Fill blanks",
          }[value] || value
        );

      const escapeHtml = (str) =>
        str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");

      //
      // Render the right-side panel based on currentState + activeTab
      //
      const renderOutput = () => {
        const { currentSession } = currentState || {};

        // Clear
        while (outputPanelEl.firstChild) {
          outputPanelEl.removeChild(outputPanelEl.firstChild);
        }

        if (!currentSession) {
          const p = document.createElement("p");
          p.className = "output-empty";
          p.innerHTML =
            "No session loaded yet. Submit code on the left, then ask ChatGPT to explain, trace, or draw environment diagrams.";
          outputPanelEl.appendChild(p);
          return;
        }

        const notes = currentSession.modelNotes || {};
        const envDiagram = currentSession.envDiagram || null;

        const makeBlock = (title, bodyText, isMono = false, extraClass = "") => {
          const wrapper = document.createElement("div");
          if (extraClass) wrapper.className = extraClass;

          const h4 = document.createElement("h4");
          h4.textContent = title;
          wrapper.appendChild(h4);

          const body = document.createElement(isMono ? "pre" : "div");
          if (isMono) {
            body.className = "mono-box";
            body.textContent = bodyText;
          } else {
            body.innerHTML = bodyText;
          }
          wrapper.appendChild(body);

          return wrapper;
        };

        const ensureContentOrHint = (kind) => {
          const p = document.createElement("p");
          p.className = "output-empty";
          let message = "";

          switch (kind) {
            case "summary":
              message =
                "Ask ChatGPT: ‚ÄúSummarize what this function does using the CS61A Mentor UI.‚Äù";
              break;
            case "explanation":
              message =
                "Ask ChatGPT: ‚ÄúExplain this code step-by-step in the CS61A Mentor panel.‚Äù";
              break;
            case "trace":
              message =
                "Ask ChatGPT: ‚ÄúTrace the recursion for this function using the CS61A Mentor UI.‚Äù";
              break;
            case "env":
              message =
                "Ask ChatGPT: ‚ÄúDraw the environment diagram for this code in the CS61A Mentor UI.‚Äù";
              break;
            case "trees":
              message =
                "Ask ChatGPT: ‚ÄúExplain the tree / linked-list behavior in the CS61A Mentor UI.‚Äù";
              break;
            case "fill":
              message =
                "Ask ChatGPT: ‚ÄúHelp me fill in the blanks for this CS61A problem in the Mentor panel.‚Äù";
              break;
            case "status":
              message =
                "Status messages, warnings, or error explanations from the Mentor will appear here.";
              break;
          }

       

          p.textContent = message;
          outputPanelEl.appendChild(p);
        };

        switch (activeTab) {
          case "summary": {
            if (notes.summary) {
              outputPanelEl.appendChild(
                makeBlock("High-level summary", notes.summary, false)
              );
            } else {
              ensureContentOrHint("summary");
            }
            break;
          }
          case "explanation": {
            if (notes.explanation) {
              outputPanelEl.appendChild(
                makeBlock(
                  "Step-by-step explanation",
                  notes.explanation,
                  true,
                  ""
                )
              );
            } else {
              ensureContentOrHint("explanation");
            }
            break;
          }
          case "trace": {
            if (notes.recursionTrace) {
              outputPanelEl.appendChild(
                makeBlock(
                  "Recursion trace",
                  notes.recursionTrace,
                  true,
                  ""
                )
              );
            } else {
              ensureContentOrHint("trace");
            }
            break;
          }
          case "env": {
            if (envDiagram?.text) {
              outputPanelEl.appendChild(
                makeBlock(
                  "Environment diagram (ASCII)",
                  envDiagram.text,
                  true,
                  ""
                )
              );
            } else {
              ensureContentOrHint("env");
            }
            break;
          }
          case "trees": {
            if (notes.treeHelp) {
              outputPanelEl.appendChild(
                makeBlock("Trees / Links help", notes.treeHelp, true, "")
              );
            } else {
              ensureContentOrHint("trees");
            }
            break;
          }
          case "fill": {
            if (notes.fillBlanksHelp) {
              outputPanelEl.appendChild(
                makeBlock(
                  "Fill-in-the-blanks guidance",
                  notes.fillBlanksHelp,
                  true,
                  ""
                )
              );
            } else {
              ensureContentOrHint("fill");
            }
            break;
          }
          case "status": {
            if (notes.error) {
              const block = makeBlock("Mentor status", notes.error, false, "");
              block.querySelector("div").classList.add("error-text");
              outputPanelEl.appendChild(block);
            } else {
              ensureContentOrHint("status");
            }
            break;
          }
          default: {
            ensureContentOrHint("summary");
          }
        }
      };

      //
      // Render session header (badges + snippet)
      //
      const renderSessionHeader = () => {
        const { currentSession } = currentState || {};

        badgeRowEl.innerHTML = "";
        codeSnippetEl.style.display = "none";
        codeHeaderEl.style.display = "none";

        if (!currentSession) {
          summaryTextEl.innerHTML =
            "<em>No active CS61A session yet. Submit code to create one.</em>";
          return;
        }

        const {
          language,
          taskType,
          question,
          code,
          modelNotes = {},
        } = currentSession;

        // Badges
        const langBadge = document.createElement("span");
        langBadge.className = "badge accent";
        langBadge.textContent = `Language: ${languageLabel(language)}`;
        badgeRowEl.appendChild(langBadge);

        const taskBadge = document.createElement("span");
        taskBadge.className = "badge";
        taskBadge.textContent = `Task: ${taskLabel(taskType)}`;
        badgeRowEl.appendChild(taskBadge);

        if (question) {
          const qBadge = document.createElement("span");
          qBadge.className = "badge";
          qBadge.textContent = `Question: ${question}`;
          badgeRowEl.appendChild(qBadge);
        }

        // Summary line
        if (modelNotes.summary) {
          summaryTextEl.innerHTML = `<strong>Mentor summary:</strong> ${modelNotes.summary}`;
        } else {
          summaryTextEl.innerHTML =
            "<strong>Session loaded.</strong> Ask ChatGPT to explain, trace, or draw an environment diagram using this session.";
        }

        // Code snippet
        if (code) {
          codeHeaderEl.style.display = "block";
          codeSnippetEl.style.display = "block";
          codeSnippetEl.textContent =
            code.length > 500 ? code.slice(0, 500) + "\n‚Ä¶ (truncated)" : code;
        }
      };

      const render = () => {
        renderSessionHeader();
        renderOutput();
      };

      //
      // Listen for state updates from ChatGPT
      //
      window.addEventListener("openai:set_globals", (ev) => {
        const detail = ev.detail || {};
        const g = detail.globals || detail.state || detail;
        if (g?.toolOutput) {
          currentState = g.toolOutput;
          render();
        }
      });

      // In case the platform uses a different event name:
      window.addEventListener("openai:state_updated", (ev) => {
        const s = ev.detail?.state;
        if (!s) return;
        const maybe =
          s.toolOutput ||
          s; /* tolerate either direct or nested toolOutput */
        if (maybe?.currentSession || maybe?.recentSessions) {
          currentState = maybe;
          render();
        }
      });

      //
      // Call tools from inside the widget
      //
      const callToolFromWidget = async (name, args) => {
        // New-style API
        if (window.openai?.tools?.call) {
          return await window.openai.tools.call({
            name,
            arguments: args,
          });
        }

        // Legacy API
        if (window.openai?.callTool) {
          return await window.openai.callTool(name, args);
        }

        throw new Error("openai tool-calling API is not available in this context.");
      };

      const callMentorTool = async (payload) => {
        const response = await callToolFromWidget("set_cs61a_context", payload);

        if (response?.toolOutput) {
          currentState = response.toolOutput;
        } else if (response?.structuredContent) {
          currentState = response.structuredContent;
        }

        render();
      };

      const callListSessions = async () => {
        const response = await callToolFromWidget("list_cs61a_sessions", {});
        if (response?.toolOutput) {
          currentState = response.toolOutput;
          render();
        }
      };

      //
      // Handle tab switching
      //
      tabsRowEl.addEventListener("click", (ev) => {
        const tabEl = ev.target.closest(".tab");
        if (!tabEl) return;

        const tabId = tabEl.dataset.tab;
        if (!tabId) return;

        activeTab = tabId;

        for (const el of tabsRowEl.querySelectorAll(".tab")) {
          el.classList.toggle("active", el.dataset.tab === tabId);
        }

        renderOutput();
      });

      //
      // Form submit ‚Üí set_cs61a_context
      //
      formEl.addEventListener("submit", async (ev) => {
        ev.preventDefault();

        const code = codeInput.value.trim();
        const language = langSelect.value;
        const taskType = taskSelect.value;
        const question = questionInput.value.trim();

        if (!code) {
          statusEl.dataset.state = "idle";
          statusEl.textContent = "Please paste some code first.";
          return;
        }

        const payload = {
          code,
          language,
          taskType,
          question: question || null,
        };

        submitBtn.disabled = true;
        statusEl.dataset.state = "loading";
        statusEl.textContent = "Sending context to CS61A Mentor‚Ä¶";

        try {
          await callMentorTool(payload);
          statusEl.dataset.state = "ok";
          statusEl.textContent =
            "Context updated. Now ask ChatGPT to explain / trace / diagram using this session.";
        } catch (err) {
          console.error("Error calling set_cs61a_context:", err);
          statusEl.dataset.state = "idle";
          statusEl.textContent =
            "Error updating context. Check console / server logs.";
        } finally {
          submitBtn.disabled = false;
        }
      });

      //
      // Refresh button ‚Üí list_cs61a_sessions
      //
      refreshBtn.addEventListener("click", async () => {
        statusEl.dataset.state = "loading";
        statusEl.textContent = "Refreshing session from server‚Ä¶";

        try {
          await callListSessions();
          statusEl.dataset.state = "ok";
          statusEl.textContent = "Session refreshed from server.";
        } catch (err) {
          console.error("Error calling list_cs61a_sessions:", err);
          statusEl.dataset.state = "idle";
          statusEl.textContent =
            "Error refreshing session. Check console / server logs.";
        }
      });

      // Initial render
      render();
    </script>
  </body>
</html>
