# ğŸ—ï¸ AlgoTutor Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ChatGPT Client                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  User sends message                       â”‚  â”‚
â”‚  â”‚  "Use AlgoTutor to explain binary search"                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ChatGPT Model analyzes intent                â”‚  â”‚
â”‚  â”‚         Decides to call AlgoTutor learn_mode tool         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTP POST
                          â”‚ /mcp
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AlgoTutor MCP Server                         â”‚
â”‚                     (server.js)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             StreamableHTTPServerTransport                 â”‚  â”‚
â”‚  â”‚              - Handles HTTP requests                      â”‚  â”‚
â”‚  â”‚              - CORS management                            â”‚  â”‚
â”‚  â”‚              - Session management                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    McpServer Instance                     â”‚  â”‚
â”‚  â”‚              name: "algo-tutor"                           â”‚  â”‚
â”‚  â”‚              version: "1.0.0"                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚        â”‚                     â”‚                     â”‚           â”‚
â”‚        â–¼                     â–¼                     â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  learn   â”‚        â”‚  build   â”‚         â”‚  debug   â”‚        â”‚
â”‚  â”‚  _mode   â”‚        â”‚  _mode   â”‚         â”‚  _mode   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚                     â”‚                     â”‚            â”‚
â”‚       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚            â”‚
â”‚       â”‚    â”‚                                  â”‚    â”‚            â”‚
â”‚       â–¼    â–¼                                  â–¼    â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Zod Schema Validation                   â”‚   â”‚
â”‚  â”‚   - Validates inputs                                    â”‚   â”‚
â”‚  â”‚   - Type-safe parsing                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                 â”‚
â”‚                              â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Tool Handler Functions                     â”‚   â”‚
â”‚  â”‚   - Create session                                      â”‚   â”‚
â”‚  â”‚   - Generate output structure                           â”‚   â”‚
â”‚  â”‚   - Return toolOutput                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                 â”‚
â”‚                              â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Widget Resource Registry                   â”‚   â”‚
â”‚  â”‚   uri: "ui://widget/algo-tutor.html"                    â”‚   â”‚
â”‚  â”‚   mimeType: "text/html+skybridge"                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTP Response
                          â”‚ toolOutput: { mode, outputs, sessionId }
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ChatGPT Client                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Receives tool response                         â”‚  â”‚
â”‚  â”‚     Triggers openai:set_globals event                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              AlgoTutor Widget (HTML)                      â”‚  â”‚
â”‚  â”‚              (algo-tutor.html)                            â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚        JavaScript Event Handler                   â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   window.addEventListener("openai:set_globals")   â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                              â”‚                            â”‚  â”‚
â”‚  â”‚                              â–¼                            â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚          State Update & Re-render                 â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   currentState = ev.detail.globals.toolOutput     â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   renderOutputs(currentState.outputs)             â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                              â”‚                            â”‚  â”‚
â”‚  â”‚                              â–¼                            â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚            Output Blocks Rendered                 â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   â–¸ Pattern Detection                             â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   â–¸ Step-by-Step Reasoning                        â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   â–¸ Code Solution                                 â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   â–¸ Dry-Run Table                                 â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   â–¸ Paper Version                                 â”‚   â”‚  â”‚
â”‚  â”‚   â”‚   â–¸ Edge Cases                                    â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  User sees structured output in AlgoTutor panel                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### 1. Learn Mode Example

```
User Input (ChatGPT):
  "Use AlgoTutor to explain binary search with dumb-it-down difficulty"

ChatGPT Decision:
  Tool: learn_mode
  Arguments: {
    topic: "binary search",
    difficulty: "dumb-it-down",
    depth: "normal",
    exampleSize: "small",
    showEdgeCases: true,
    showDryRun: true,
    showPaperVersion: true
  }

Server Processing:
  1. Validate input with Zod
  2. Create session-X
  3. Generate output structure
  4. Return: {
       state: "update",
       toolOutput: {
         mode: "learn",
         outputs: {
           pattern: "...",
           stepByStep: "...",
           code: "...",
           dryRunTable: [...],
           paperVersion: [...],
           edgeCases: [...]
         }
       }
     }

Widget Processing:
  1. Receive openai:set_globals event
  2. Extract toolOutput from event
  3. Call renderOutputs(outputs)
  4. Generate HTML blocks
  5. Insert into DOM

User Sees:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â–¸ Pattern Detection        â”‚
  â”‚  "Divide-and-conquer..."    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  â–¸ Step-by-Step Reasoning   â”‚
  â”‚  "1. Start with low=0..."   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  â–¸ Code Solution            â”‚
  â”‚  def binary_search(arr):    â”‚
  â”‚      ...                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  â–¸ Dry-Run Table            â”‚
  â”‚  step | low | high | mid... â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  â–¸ Paper Version            â”‚
  â”‚  â€¢ Write bounds             â”‚
  â”‚  â€¢ Calculate mid            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  â–¸ Edge Cases               â”‚
  â”‚  â€¢ Empty array              â”‚
  â”‚  â€¢ Single element           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Architecture

### Server Components

```
server.js
â”œâ”€â”€ HTTP Server (Node.js http)
â”‚   â”œâ”€â”€ Health check: GET /
â”‚   â”œâ”€â”€ CORS preflight: OPTIONS /mcp
â”‚   â””â”€â”€ MCP endpoint: POST/GET/DELETE /mcp
â”‚
â”œâ”€â”€ MCP Server
â”‚   â”œâ”€â”€ McpServer instance
â”‚   â”‚   â”œâ”€â”€ name: "algo-tutor"
â”‚   â”‚   â””â”€â”€ version: "1.0.0"
â”‚   â”‚
â”‚   â”œâ”€â”€ Tools
â”‚   â”‚   â”œâ”€â”€ learn_mode
â”‚   â”‚   â”‚   â”œâ”€â”€ inputSchema (Zod)
â”‚   â”‚   â”‚   â”œâ”€â”€ handler (async function)
â”‚   â”‚   â”‚   â””â”€â”€ _meta (OpenAI instructions)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ build_mode
â”‚   â”‚   â”‚   â”œâ”€â”€ inputSchema (Zod)
â”‚   â”‚   â”‚   â”œâ”€â”€ handler (async function)
â”‚   â”‚   â”‚   â””â”€â”€ _meta (OpenAI instructions)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ debug_mode
â”‚   â”‚   â”‚   â”œâ”€â”€ inputSchema (Zod)
â”‚   â”‚   â”‚   â”œâ”€â”€ handler (async function)
â”‚   â”‚   â”‚   â””â”€â”€ _meta (OpenAI instructions)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ list_algo_sessions
â”‚   â”‚       â”œâ”€â”€ inputSchema (Zod)
â”‚   â”‚       â””â”€â”€ handler (async function)
â”‚   â”‚
â”‚   â”œâ”€â”€ Resources
â”‚   â”‚   â””â”€â”€ algo-tutor-widget
â”‚   â”‚       â”œâ”€â”€ uri: "ui://widget/algo-tutor.html"
â”‚   â”‚       â”œâ”€â”€ mimeType: "text/html+skybridge"
â”‚   â”‚       â””â”€â”€ text: HTML content
â”‚   â”‚
â”‚   â””â”€â”€ Session Storage
â”‚       â”œâ”€â”€ sessions: Array
â”‚       â””â”€â”€ nextId: Number
â”‚
â””â”€â”€ Transport
    â””â”€â”€ StreamableHTTPServerTransport
        â”œâ”€â”€ enableJsonResponse: true
        â””â”€â”€ sessionIdGenerator: undefined
```

### Widget Components

```
algo-tutor.html
â”œâ”€â”€ HTML Structure
â”‚   â”œâ”€â”€ Header
â”‚   â”‚   â”œâ”€â”€ Title: "AlgoTutor"
â”‚   â”‚   â”œâ”€â”€ Tagline
â”‚   â”‚   â””â”€â”€ Mode Selector Buttons
â”‚   â”‚
â”‚   â”œâ”€â”€ Layout (2-column grid)
â”‚   â”‚   â”œâ”€â”€ Left Pane: Input Forms
â”‚   â”‚   â”‚   â”œâ”€â”€ Learn Mode Form
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Topic input
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Difficulty select
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Depth select
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Example size select
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Toggles (checkboxes)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Submit button
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Build Mode Form
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Problem textarea
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Language select
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Toggles (checkboxes)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Submit button
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Debug Mode Form
â”‚   â”‚   â”‚       â”œâ”€â”€ Code textarea
â”‚   â”‚   â”‚       â”œâ”€â”€ Input sample input
â”‚   â”‚   â”‚       â”œâ”€â”€ Language select
â”‚   â”‚   â”‚       â”œâ”€â”€ Toggles (checkboxes)
â”‚   â”‚   â”‚       â””â”€â”€ Submit button
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Right Pane: Output Container
â”‚   â”‚       â””â”€â”€ Dynamic output blocks
â”‚   â”‚
â”‚   â””â”€â”€ CSS (embedded)
â”‚       â”œâ”€â”€ Variables (colors, spacing)
â”‚       â”œâ”€â”€ Layout styles
â”‚       â”œâ”€â”€ Form styles
â”‚       â””â”€â”€ Output block styles
â”‚
â””â”€â”€ JavaScript (embedded)
    â”œâ”€â”€ State Management
    â”‚   â”œâ”€â”€ currentMode: String
    â”‚   â””â”€â”€ currentState: Object
    â”‚
    â”œâ”€â”€ Event Handlers
    â”‚   â”œâ”€â”€ Mode button clicks
    â”‚   â”œâ”€â”€ Form submissions
    â”‚   â”‚   â”œâ”€â”€ Learn form â†’ callToolFromWidget("learn_mode")
    â”‚   â”‚   â”œâ”€â”€ Build form â†’ callToolFromWidget("build_mode")
    â”‚   â”‚   â””â”€â”€ Debug form â†’ callToolFromWidget("debug_mode")
    â”‚   â”‚
    â”‚   â””â”€â”€ State updates
    â”‚       â”œâ”€â”€ openai:set_globals
    â”‚       â””â”€â”€ openai:state_updated
    â”‚
    â”œâ”€â”€ Rendering Functions
    â”‚   â”œâ”€â”€ renderOutputs(outputs)
    â”‚   â”‚   â”œâ”€â”€ Creates output blocks
    â”‚   â”‚   â”œâ”€â”€ Handles different types (text, code, table, list)
    â”‚   â”‚   â””â”€â”€ Inserts into DOM
    â”‚   â”‚
    â”‚   â”œâ”€â”€ renderTable(rows)
    â”‚   â”‚   â””â”€â”€ Generates HTML table
    â”‚   â”‚
    â”‚   â””â”€â”€ escapeHtml(str)
    â”‚       â””â”€â”€ Sanitizes text
    â”‚
    â””â”€â”€ Utility Functions
        â”œâ”€â”€ getInitialState()
        â”œâ”€â”€ callToolFromWidget(name, args)
        â””â”€â”€ Mode switching logic
```

---

## Communication Protocol

### MCP Tool Call Flow

```
1. ChatGPT â†’ AlgoTutor Server
   POST /mcp
   Headers:
     Content-Type: application/json
     Mcp-Session-Id: <optional>
   Body:
     {
       "jsonrpc": "2.0",
       "method": "tools/call",
       "params": {
         "name": "learn_mode",
         "arguments": {
           "topic": "binary search",
           "difficulty": "normal",
           ...
         }
       },
       "id": 1
     }

2. Server Validates Input
   - Zod schema checks types
   - Returns error if invalid

3. Server Creates Session
   - Generate session ID
   - Store in memory
   - Create output structure

4. Server â†’ ChatGPT
   Response:
     {
       "jsonrpc": "2.0",
       "result": {
         "state": "update",
         "content": [
           {
             "type": "text",
             "text": "Lesson ready! Check the panel."
           }
         ],
         "toolOutput": {
           "mode": "learn",
           "outputs": { ... },
           "sessionId": "session-1"
         }
       },
       "id": 1
     }

5. ChatGPT â†’ Widget
   Event: openai:set_globals
   Payload:
     {
       "globals": {
         "toolOutput": {
           "mode": "learn",
           "outputs": { ... }
         }
       }
     }

6. Widget Updates UI
   - Extract outputs from event
   - Call renderOutputs()
   - Display structured blocks
```

---

## State Management

### Server State

```javascript
// In-memory storage
let sessions = [
  {
    id: "session-1",
    mode: "learn",
    timestamp: "2025-11-16T10:30:00Z",
    input: { topic: "binary search", ... }
  },
  {
    id: "session-2",
    mode: "build",
    timestamp: "2025-11-16T10:35:00Z",
    input: { problem: "Two Sum", ... }
  }
];

let nextId = 3;
```

### Widget State

```javascript
let currentState = {
  mode: "learn",
  outputs: {
    pattern: "...",
    stepByStep: "...",
    code: "...",
    dryRunTable: [...],
    paperVersion: [...],
    edgeCases: [...]
  },
  sessionId: "session-1"
};

let currentMode = "learn"; // or "build", "debug"
```

---

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ChatGPT (Trusted)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTPS
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CORS Validation            â”‚
â”‚   - Check origin                    â”‚
â”‚   - Validate headers                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Input Validation            â”‚
â”‚   - Zod schema checks               â”‚
â”‚   - Type enforcement                â”‚
â”‚   - Length limits                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Tool Execution              â”‚
â”‚   - Session creation                â”‚
â”‚   - Output generation               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Output Sanitization            â”‚
â”‚   - Escape HTML (in widget)         â”‚
â”‚   - Prevent XSS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Response to ChatGPT            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Scalability Considerations

### Current Architecture (Single Server)
```
ChatGPT â†’ Server (8787) â†’ In-memory storage
            â†“
     Widget rendering
```

Limitations:
- Single point of failure
- Memory-only sessions (lost on restart)
- Limited concurrent users

### Scaled Architecture (Recommended)

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
ChatGPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ Load Balancerâ”‚
                         â”‚   (Nginx)    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚              â”‚              â”‚
                 â–¼              â–¼              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Server 1 â”‚   â”‚ Server 2 â”‚   â”‚ Server 3 â”‚
         â”‚  (8787)  â”‚   â”‚  (8787)  â”‚   â”‚  (8787)  â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚              â”‚              â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚     Redis     â”‚
                      â”‚ (Session Storeâ”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Benefits:
- High availability
- Horizontal scaling
- Persistent sessions
- Better performance

---

## Performance Metrics

### Target Performance

| Metric | Target | Notes |
|--------|--------|-------|
| Tool call latency | < 500ms | Server processing time |
| Widget render time | < 100ms | Client-side rendering |
| Concurrent users | 100+ | With single server |
| Session storage | 10,000+ | In-memory (8GB RAM) |
| Uptime | 99.9% | With load balancer |

### Optimization Strategies

1. **Caching**
   - Cache common topics (binary search, BFS, etc.)
   - Use Redis for distributed cache
   - Implement TTL-based expiration

2. **Database**
   - Move sessions to PostgreSQL
   - Index by sessionId and userId
   - Archive old sessions

3. **CDN**
   - Serve widget HTML via CDN
   - Reduce server load
   - Faster widget loading

4. **Async Processing**
   - Use async/await throughout
   - Non-blocking I/O
   - Worker threads for heavy computations

---

## Monitoring & Observability

### Recommended Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Logs             â”‚
â”‚        (Winston / Pino)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Log Aggregation                 â”‚
â”‚    (Papertrail / Logtail)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Error Tracking                 â”‚
â”‚          (Sentry)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Performance Monitoring            â”‚
â”‚   (New Relic / DataDog)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Alerting & Dashboards           â”‚
â”‚        (PagerDuty)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Topology

### Development
```
Developer Machine
â”œâ”€â”€ npm start (port 8787)
â”œâ”€â”€ ngrok http 8787
â””â”€â”€ ChatGPT connects to ngrok URL
```

### Production (Cloud)
```
Cloud Provider (Railway/Render/DigitalOcean)
â”œâ”€â”€ HTTPS (automatic SSL)
â”œâ”€â”€ Auto-scaling
â”œâ”€â”€ Health checks
â”œâ”€â”€ Logging
â””â”€â”€ ChatGPT connects to production URL
```

### Enterprise (Self-hosted)
```
VPS/EC2
â”œâ”€â”€ Nginx (reverse proxy + SSL)
â”œâ”€â”€ PM2 (process manager)
â”œâ”€â”€ Redis (session storage)
â”œâ”€â”€ PostgreSQL (persistent data)
â”œâ”€â”€ Monitoring (Prometheus/Grafana)
â””â”€â”€ Backup & disaster recovery
```

---

**Last Updated:** November 16, 2025  
**Version:** 1.0.0

